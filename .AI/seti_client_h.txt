#ifndef CLIENT_H
#define CLIENT_H

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <pthread.h>
#include <stdint.h>

#define MAX_MESSAGE_LEN 256
#define MAX_MESS_LEN 200
#define ID_LEN 8
#define PORT_LEN 4
#define BUFFER_SIZE 1024

// Struttura per le informazioni del client
typedef struct {
    char id[ID_LEN + 1];
    uint16_t udp_port;
    uint16_t password;
    int tcp_socket;
    int udp_socket;
    char server_ip[16];
    int server_port;
    int connected;
    int registered;
    pthread_t udp_thread;
} Client;

// Funzioni di utilit√†
void print_verbose(const char *direction, const char *message);
void encode_password(uint16_t password, char *buffer);
void encode_port(uint16_t port, char *buffer);
void encode_num_item(int num, char *buffer);
uint16_t decode_password(const char *buffer);
uint16_t decode_port(const char *buffer);
int decode_hex_little_endian(const char *hex);

// Funzioni di rete
int create_tcp_socket();
int create_udp_socket(uint16_t port);
int connect_to_server(Client *client);
void close_connection(Client *client);

// Funzioni per l'invio di messaggi
int send_tcp_message(int socket, const char *message);
int send_regis(Client *client);
int send_conne(Client *client);
int send_frie_request(Client *client, const char *friend_id);
int send_message(Client *client, const char *friend_id, const char *message);
int send_flood(Client *client, const char *message);
int send_list_request(Client *client);
int send_consu(Client *client);
int send_quit(Client *client);

// Funzioni per la ricezione di messaggi
int receive_tcp_message(int socket, char *buffer, int size);
void handle_tcp_response(Client *client, const char *response);
void handle_consu_response(Client *client, const char *response);
void *udp_listener_thread(void *arg);

// Funzioni di inizializzazione e menu
void init_client(Client *client);
void print_menu();
void run_client(Client *client);

#endif