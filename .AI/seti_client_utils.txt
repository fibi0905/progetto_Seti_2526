#include "client.h"

// Stampa verbose per debug
void print_verbose(const char *direction, const char *message) {
    printf("[%s] %s\n", direction, message);
}

// Codifica password in little-endian (2 byte)
void encode_password(uint16_t password, char *buffer) {
    buffer[0] = (char)(password & 0xFF);
    buffer[1] = (char)((password >> 8) & 0xFF);
}

// Decodifica password da little-endian
uint16_t decode_password(const char *buffer) {
    return (uint16_t)((unsigned char)buffer[0] | ((unsigned char)buffer[1] << 8));
}

// Codifica porta come stringa di 4 caratteri con zeri iniziali
void encode_port(uint16_t port, char *buffer) {
    snprintf(buffer, PORT_LEN + 1, "%04u", port);
}

// Decodifica porta da stringa
uint16_t decode_port(const char *buffer) {
    char temp[PORT_LEN + 1];
    strncpy(temp, buffer, PORT_LEN);
    temp[PORT_LEN] = '\0';
    return (uint16_t)atoi(temp);
}

// Codifica numero item come stringa di 3 caratteri con zeri iniziali
void encode_num_item(int num, char *buffer) {
    snprintf(buffer, 4, "%03d", num);
}

// Decodifica esadecimale little-endian da 2 caratteri
int decode_hex_little_endian(const char *hex) {
    // Esempio: "0a" in little-endian = 0x0a = 10
    char temp[3];
    temp[0] = hex[0];
    temp[1] = hex[1];
    temp[2] = '\0';
    
    int value;
    sscanf(temp, "%02x", &value);
    return value;
}